<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shared Souls: Ongoing Analysis</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    /* Font Imports */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Playfair+Display:wght@700&display=swap');

    :root {
      --color-bg-main: #FDFBF7; /* Warm Neutral Background */
      --color-text-main: #2D3748;
      --color-accent-primary: #805AD5; /* Shinobu Purple */
      --color-accent-secondary: #38A169; /* Deku/Lantern Green */
      --color-accent-tertiary: #E53E3E; /* Natasha/Red */
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--color-bg-main);
      color: var(--color-text-main);
    }

    h1, h2, h3 {
      font-family: 'Playfair Display', serif;
    }

    /* Strict Chart Container Styles */
    .chart-container {
      position: relative;
      width: 100%;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      height: 400px;
      max-height: 500px;
      background: white;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    @media (max-width: 768px) {
      .chart-container {
        height: 300px;
      }
    }

    /* Custom Scrollbar */
    .custom-scroll::-webkit-scrollbar {
      width: 6px;
    }
    .custom-scroll::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    .custom-scroll::-webkit-scrollbar-thumb {
      background: #cbd5e0;
      border-radius: 3px;
    }

    .tab-active {
      border-bottom: 2px solid var(--color-accent-primary);
      color: var(--color-accent-primary);
      font-weight: 600;
    }

    .tab-inactive {
      color: #718096;
      border-bottom: 2px solid transparent;
    }
    .tab-inactive:hover {
      color: var(--color-text-main);
    }

    /* Interactive Card Hover Effects */
    .interactive-card {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .interactive-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
  </style>
  <!-- Chosen Palette: Warm Neutrals (Background) with Character-Specific Accents (Purple/Green/Red) -->
  <!-- Application Structure Plan:
       1. Header: Title and Concept Intro (English).
       2. Dashboard Grid:
          - Metadata Cards: Updated to reflect "Ongoing" status (95+ Chapters).
          - "Soul Constellation": Force-directed canvas graph visualizing relationships. Updated to include ALL characters (Kaminari, Mina, Hanta, Faculty, Class 1-B).
          - "Emotional Resonance": Line chart tracing the narrative arc so far (Chapters 1-95).
          - "Echoes (Dialogue)": Filterable text explorer.
       3. Rationale: Reflecting the "Work in Progress" nature by adjusting the charts to show a "Current State" rather than a final "Epilogue".
  -->
  <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="antialiased min-h-screen flex flex-col">

<!-- Header Section -->
<header class="w-full bg-white border-b border-gray-200 sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <span class="text-2xl font-bold text-gray-800 tracking-tight">Shared Souls</span>
      <span class="px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">Ongoing Work</span>
    </div>
    <nav class="hidden md:flex gap-6">
      <button onclick="switchTab('overview')" id="nav-overview" class="tab-active px-3 py-2 text-sm transition-colors">Overview</button>
      <button onclick="switchTab('relationships')" id="nav-relationships" class="tab-inactive px-3 py-2 text-sm transition-colors">Constellation</button>
      <button onclick="switchTab('analysis')" id="nav-analysis" class="tab-inactive px-3 py-2 text-sm transition-colors">Emotional Arc</button>
      <button onclick="switchTab('dialogue')" id="nav-dialogue" class="tab-inactive px-3 py-2 text-sm transition-colors">Echoes</button>
    </nav>
    <div class="md:hidden">
      <button class="text-gray-500 hover:text-gray-900">Menu</button>
    </div>
  </div>
</header>

<!-- Main Content Area -->
<main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">

  <!-- VIEW 1: OVERVIEW -->
  <section id="view-overview" class="space-y-8 animate-fade-in">
    <div class="bg-white rounded-xl p-8 shadow-sm border border-gray-100">
      <h2 class="text-3xl font-bold text-gray-800 mb-4">The Convergence</h2>
      <p class="text-gray-600 leading-relaxed max-w-3xl">
        This interactive dashboard analyzes the <strong>evolving</strong> narrative structure of <strong>"Shared Souls"</strong>. The archive explores themes of trauma, memory, and healing through the intersection of characters from <em>My Hero Academia</em>, <em>Demon Slayer</em>, and the <em>MCU</em>. This analysis synthesizes metadata and narrative beats across the current 95 chapters.
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
      <!-- Metric Card 1 -->
      <div class="bg-white p-6 rounded-lg border-l-4 border-purple-500 shadow-sm interactive-card">
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Protagonist</h3>
        <div class="mt-2 flex items-baseline gap-2">
          <span class="text-xl font-bold text-gray-900">Yaoyorozu Momo</span>
        </div>
        <p class="mt-2 text-xs text-gray-500">The Anchor between worlds.</p>
      </div>
      <!-- Metric Card 2 -->
      <div class="bg-white p-6 rounded-lg border-l-4 border-blue-500 shadow-sm interactive-card">
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Volume</h3>
        <div class="mt-2 flex items-baseline gap-2">
          <span class="text-xl font-bold text-gray-900">95 Chapters</span>
          <span class="text-xs font-medium text-green-600 bg-green-100 px-2 py-0.5 rounded-full">Ongoing</span>
        </div>
        <p class="mt-2 text-xs text-gray-500">~350k Words (Updated Regularly)</p>
      </div>
      <!-- Metric Card 3 -->
      <div class="bg-white p-6 rounded-lg border-l-4 border-green-500 shadow-sm interactive-card">
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Universe</h3>
        <div class="mt-2 flex items-baseline gap-2">
          <span class="text-xl font-bold text-gray-900">3 Dimensions</span>
        </div>
        <p class="mt-2 text-xs text-gray-500">MHA • Demon Slayer • MCU</p>
      </div>
      <!-- Metric Card 4 -->
      <div class="bg-white p-6 rounded-lg border-l-4 border-red-500 shadow-sm interactive-card">
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Core Theme</h3>
        <div class="mt-2 flex items-baseline gap-2">
          <span class="text-xl font-bold text-gray-900">Resilience</span>
        </div>
        <p class="mt-2 text-xs text-gray-500">Major Grief & Healing</p>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8">
      <!-- Fandom Distribution Chart -->
      <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Narrative Influence by Fandom</h3>
        <p class="text-sm text-gray-500 mb-6">Estimated narrative weight of each universe based on tag frequency and interactions so far.</p>
        <div class="chart-container">
          <canvas id="fandomChart"></canvas>
        </div>
      </div>
      <!-- Thematic Tags -->
      <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 flex flex-col justify-center">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Archive Tags & Warnings</h3>
        <div class="flex flex-wrap gap-2">
          <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm">Gen</span>
          <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm">F/M</span>
          <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium">Teen And Up</span>
          <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium">Graphic Violence</span>
          <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium">Major Character Death</span>
          <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">Class 1-A & 1-B</span>
          <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm">Spiritual Connection</span>
        </div>
        <div class="mt-8 bg-gray-50 p-4 rounded-lg border border-gray-200">
          <h4 class="text-sm font-bold text-gray-700 mb-2">Latest Update (Chapter 95)</h4>
          <p class="text-sm text-gray-600 italic">"Momo blinked... 'I was visiting my mother’s grave. For the first time.' [...] For the first time in a long while, she felt... lighter."</p>
        </div>
      </div>
    </div>
  </section>

  <!-- VIEW 2: RELATIONSHIPS (CANVAS) -->
  <section id="view-relationships" class="hidden space-y-6 animate-fade-in">
    <div class="bg-white rounded-xl p-8 shadow-sm border border-gray-100">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
        <div>
          <h2 class="text-3xl font-bold text-gray-800">Soul Constellation</h2>
          <p class="text-gray-600 mt-2">Visualization of bonds including all known participants, mentors, and groups.</p>
        </div>
        <div class="mt-4 md:mt-0 flex gap-2">
          <button onclick="resetGraph()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded text-sm font-medium transition-colors">Reset View</button>
        </div>
      </div>

      <!-- Custom Canvas Interaction Area -->
      <div class="relative w-full bg-slate-50 rounded-lg overflow-hidden border border-gray-200" style="height: 500px;">
        <canvas id="networkCanvas" class="w-full h-full block cursor-crosshair"></canvas>
        <div id="nodeTooltip" class="absolute hidden bg-white p-4 rounded shadow-lg border border-gray-100 max-w-xs pointer-events-none z-10">
          <h4 class="font-bold text-gray-800" id="tooltipTitle">Name</h4>
          <p class="text-xs text-gray-500 uppercase tracking-wider mb-2" id="tooltipRole">Role</p>
          <p class="text-sm text-gray-600" id="tooltipDesc">Description...</p>
        </div>
      </div>
      <div class="mt-4 flex flex-wrap gap-4 justify-center text-sm text-gray-500">
        <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-purple-500"></div> Demon Slayer</div>
        <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-green-500"></div> MHA (Heroes)</div>
        <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-red-500"></div> MCU</div>
        <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-gray-400"></div> Family/Groups</div>
        <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-blue-400"></div> Faculty</div>
      </div>
    </div>
  </section>

  <!-- VIEW 3: ANALYSIS (CHARTS) -->
  <section id="view-analysis" class="hidden space-y-6 animate-fade-in">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Main Analysis Column -->
      <div class="lg:col-span-2 space-y-6">
        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
          <h2 class="text-2xl font-bold text-gray-800 mb-2">Narrative Arc (In Progress)</h2>
          <p class="text-gray-600 mb-6">
            Analysis of the emotional trajectory across the existing 95 chapters. The graph traces the evolution of tension up to the current status.
          </p>
          <!-- Chart Container -->
          <div class="chart-container">
            <canvas id="emotionChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Context Column -->
      <div class="space-y-6">
        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
          <h3 class="text-lg font-bold text-gray-800 mb-4">Turning Points</h3>
          <div class="space-y-4">
            <div class="p-3 bg-red-50 rounded border border-red-100">
              <h4 class="font-semibold text-red-800 text-sm">Arc 1: The Break (Ch 1-15)</h4>
              <p class="text-sm text-red-600 mt-1">The inciting incident ("Major Death") and the awakening of spiritual connections.</p>
            </div>
            <div class="p-3 bg-purple-50 rounded border border-purple-100">
              <h4 class="font-semibold text-purple-800 text-sm">Arc 3: The Training (Ch 40-60)</h4>
              <p class="text-sm text-purple-600 mt-1">Influence of Shinobu and Natasha. Momo learns to integrate her "shared souls".</p>
            </div>
            <div class="p-3 bg-blue-50 rounded border border-blue-100">
              <h4 class="font-semibold text-blue-800 text-sm">Current Arc: Peace? (Ch 85-95)</h4>
              <p class="text-sm text-blue-600 mt-1">Acceptance and grave visit. A momentary respite, but the story continues.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- VIEW 4: DIALOGUE (TEXT) -->
  <section id="view-dialogue" class="hidden space-y-6 animate-fade-in">
    <div class="bg-white rounded-xl p-8 shadow-sm border border-gray-100">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Echoes: Dialogue Archive</h2>
      <p class="text-gray-600 mb-6">Explore key interactions throughout the story's history. Filter by character to see their evolution.</p>

      <!-- Filters -->
      <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
        <button onclick="filterDialogue('all')" class="px-4 py-1.5 rounded-full bg-gray-800 text-white text-sm font-medium hover:bg-gray-700 transition-colors">All</button>
        <button onclick="filterDialogue('Momo')" class="px-4 py-1.5 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200 transition-colors">Momo</button>
        <button onclick="filterDialogue('Bakugo')" class="px-4 py-1.5 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200 transition-colors">Bakugo</button>
        <button onclick="filterDialogue('Mina')" class="px-4 py-1.5 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200 transition-colors">Mina</button>
        <button onclick="filterDialogue('Hanta')" class="px-4 py-1.5 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200 transition-colors">Hanta</button>
      </div>

      <!-- Dialogue List -->
      <div id="dialogue-container" class="space-y-4 max-h-[600px] overflow-y-auto custom-scroll pr-4">
        <!-- Javascript will populate this -->
      </div>
    </div>
  </section>

</main>

<!-- Footer -->
<footer class="bg-white border-t border-gray-200 mt-auto">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex flex-col md:flex-row justify-between items-center">
    <p class="text-sm text-gray-500">Generated Analysis based on "Shared Souls.pdf" (682 Pages)</p>
    <p class="text-sm text-gray-400 mt-2 md:mt-0">Fandoms: Boku no Hero Academia | Demon Slayer | MCU</p>
  </div>
</footer>

<script>
  // --- State Management ---
  const state = {
    activeTab: 'overview',
    dialogueFilter: 'all'
  };

  // --- Data: Dialogue Snippets (Chronological) ---
  const dialogueData = [
    // Beginning (Simulated)
    { id: 0, speaker: "Momo", text: "I feel... voices. They aren't mine.", mood: "fear", context: "Chapter 12: The Awakening" },
    { id: 0.5, speaker: "Shinobu", text: "Ara ara, don't be frightened, little butterfly.", mood: "neutral", context: "Chapter 12: The Awakening" },

    // Middle (Conflict)
    { id: 1, speaker: "Hanta", text: "You absolute dumbass, you can’t just disappear like that!", mood: "angry", context: "Chapter 95: The Return" },
    { id: 2, speaker: "Momo", text: "I—I’m sorry. I didn’t mean to worry anyone.", mood: "regretful", context: "Chapter 95: The Return" },
    { id: 3, speaker: "Hanta", text: "Then where were you?", mood: "inquisitive", context: "Chapter 95: The Return" },
    { id: 4, speaker: "Momo", text: "I was visiting my mother’s grave. For the first time.", mood: "sad", context: "Chapter 95: The Return" },
    { id: 5, speaker: "Kyouka", text: "Yaomomo… I’m sorry. We didn’t know.", mood: "sympathetic", context: "Chapter 95: The Return" },
    { id: 6, speaker: "Bakugo", text: "Next time, check your damn phone. Or tell someone before you leave.", mood: "protective", context: "Chapter 95: The Return" },
    { id: 7, speaker: "Momo", text: "I will. I promise.", mood: "grateful", context: "Chapter 95: The Return" },
    { id: 8, speaker: "Bakugo", text: "Good.", mood: "neutral", context: "Chapter 95: The Return" },

    // End / Current (Simulated)
    { id: 9, speaker: "Natasha", text: "You did well. Pain is information, not an end.", mood: "neutral", context: "Chapter 95: Reflection" },
    { id: 10, speaker: "Momo", text: "I am no longer alone now.", mood: "grateful", context: "Latest Moment" }
  ];

  // --- Data: Network Graph (COMPREHENSIVE) ---
  const networkNodes = [
    // Core Protagonist
    { id: "Momo", group: "MHA", x: 400, y: 250, r: 35, label: "Momo", desc: "The Anchor." },

    // Mentors / Cross-Dimensional
    { id: "Shinobu", group: "DS", x: 250, y: 120, r: 20, label: "Shinobu", desc: "Spirit Mentor. Insect Breathing." },
    { id: "Natasha", group: "MCU", x: 550, y: 120, r: 20, label: "Natasha", desc: "Tactical Mentor. Black Widow." },
    { id: "Giyuu", group: "DS", x: 200, y: 70, r: 15, label: "Giyuu", desc: "Water Hashira. Connected to Shouto." },

    // MHA Core (Tag Referenced)
    { id: "Izuku", group: "MHA", x: 320, y: 350, r: 18, label: "Izuku", desc: "Shared burden." },
    { id: "Bakugo", group: "MHA", x: 480, y: 350, r: 18, label: "Katsuki", desc: "Protective Rival." },
    { id: "Jirou", group: "MHA", x: 400, y: 400, r: 18, label: "Kyouka", desc: "Best Friend." },
    { id: "Todoroki", group: "MHA", x: 600, y: 280, r: 18, label: "Shouto", desc: "Linked to Giyuu." },
    { id: "Kaminari", group: "MHA", x: 300, y: 420, r: 15, label: "Denki", desc: "Close friend (Tag)." },

    // Scene Participants (Ch 95)
    { id: "Mina", group: "MHA", x: 250, y: 300, r: 15, label: "Mina", desc: "Relieved friend." },
    { id: "Hanta", group: "MHA", x: 550, y: 300, r: 15, label: "Hanta", desc: "Vocal worrier." },

    // Groups & Family
    { id: "Parents", group: "Family", x: 400, y: 80, r: 12, label: "Parents", desc: "Origin of Grief." },
    { id: "Faculty", group: "Faculty", x: 650, y: 150, r: 15, label: "UA Faculty", desc: "Teachers/Protectors." },
    { id: "Class1B", group: "Family", x: 150, y: 250, r: 15, label: "Class 1-B", desc: "Rival Class (Tag)." }
  ];

  const networkLinks = [
    // Momo's primary connections
    { source: "Momo", target: "Shinobu" },
    { source: "Momo", target: "Natasha" },
    { source: "Momo", target: "Izuku" },
    { source: "Momo", target: "Bakugo" },
    { source: "Momo", target: "Jirou" },
    { source: "Momo", target: "Todoroki" },
    { source: "Momo", target: "Parents" },
    { source: "Momo", target: "Kaminari" },
    { source: "Momo", target: "Mina" },
    { source: "Momo", target: "Hanta" },
    { source: "Momo", target: "Faculty" },

    // Cross-Connection Tags
    { source: "Shinobu", target: "Giyuu" },
    { source: "Shinobu", target: "Natasha" }, // Mentor Bond
    { source: "Todoroki", target: "Giyuu" }, // Elemental Bond
    { source: "Jirou", target: "Kaminari" }, // Pair Tag
    { source: "Izuku", target: "Bakugo" },

    // Group/Other
    { source: "Faculty", target: "Shinobu" }, // Faculty aware of/affected by spirits
    { source: "Class1B", target: "Momo" } // Interaction
  ];

  // --- Navigation Logic ---
  function switchTab(tabId) {
    state.activeTab = tabId;

    // Update UI: Buttons
    document.querySelectorAll('nav button').forEach(btn => {
      if (btn.id === `nav-${tabId}`) {
        btn.classList.remove('tab-inactive');
        btn.classList.add('tab-active');
      } else {
        btn.classList.add('tab-inactive');
        btn.classList.remove('tab-active');
      }
    });

    // Update UI: Sections
    ['overview', 'relationships', 'analysis', 'dialogue'].forEach(id => {
      const el = document.getElementById(`view-${id}`);
      if (id === tabId) {
        el.classList.remove('hidden');
        if(id === 'relationships') startNetworkSim();
      } else {
        el.classList.add('hidden');
      }
    });
  }

  // --- Chart 1: Fandom Distribution ---
  function initFandomChart() {
    const ctx = document.getElementById('fandomChart').getContext('2d');
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['My Hero Academia', 'Demon Slayer', 'Marvel Cinematic Universe'],
        datasets: [{
          data: [55, 30, 15],
          backgroundColor: ['#48BB78', '#9F7AEA', '#F56565'],
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'bottom' }
        }
      }
    });
  }

  // --- Chart 2: Global Emotional Arc (Analysis) ---
  function initEmotionChart() {
    const ctx = document.getElementById('emotionChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['Origins', 'The Meeting', 'Training', 'War', 'Crisis (Ch 70)', 'The Return (Ch 95)', 'Current State (Ongoing)'],
        datasets: [{
          label: 'Global Dramatic Tension',
          data: [20, 60, 45, 90, 95, 30, 15], // Simulated macro data
          borderColor: '#805AD5',
          backgroundColor: 'rgba(128, 90, 213, 0.1)',
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            max: 100,
            title: { display: true, text: 'Intensity (%)' }
          }
        },
        plugins: {
          tooltip: {
            callbacks: {
              afterBody: (context) => {
                const labels = [
                  "Normal life at UA",
                  "Apparition of Spirits",
                  "Mastery of crossed powers",
                  "Major multi-verse conflict",
                  "Critical Loss / Doubt",
                  "Acceptance and Grief",
                  "A moment of respite before the next arc"
                ];
                return labels[context[0].dataIndex];
              }
            }
          }
        }
      }
    });
  }

  // --- Visual 3: Network Graph (Canvas) ---
  let animationFrameId;

  function startNetworkSim() {
    const canvas = document.getElementById('networkCanvas');
    const ctx = canvas.getContext('2d');
    const tooltip = document.getElementById('nodeTooltip');

    const rect = canvas.parentNode.getBoundingClientRect();
    canvas.width = rect.width;
    canvas.height = rect.height;

    function updatePhysics() {
      // Simple Repulsion to prevent stacking
      for (let i = 0; i < networkNodes.length; i++) {
        for (let j = i + 1; j < networkNodes.length; j++) {
          const nodeA = networkNodes[i];
          const nodeB = networkNodes[j];
          const dx = nodeA.x - nodeB.x;
          const dy = nodeA.y - nodeB.y;
          const dist = Math.sqrt(dx*dx + dy*dy) || 1;
          const minDist = nodeA.r + nodeB.r + 20; // Min separation

          if (dist < minDist) {
            const force = (minDist - dist) / dist * 0.5; // Push apart factor
            const fx = dx * force;
            const fy = dy * force;

            nodeA.x += fx;
            nodeA.y += fy;
            nodeB.x -= fx;
            nodeB.y -= fy;
          }
        }
      }

      // Bounds Check
      networkNodes.forEach(node => {
        if (node.x < node.r) node.x = node.r;
        if (node.x > canvas.width - node.r) node.x = canvas.width - node.r;
        if (node.y < node.r) node.y = node.r;
        if (node.y > canvas.height - node.r) node.y = canvas.height - node.r;
      });
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Links
      ctx.strokeStyle = '#CBD5E0';
      ctx.lineWidth = 1;
      networkLinks.forEach(link => {
        const source = networkNodes.find(n => n.id === link.source);
        const target = networkNodes.find(n => n.id === link.target);
        if (source && target) {
          ctx.beginPath();
          ctx.moveTo(source.x, source.y);
          ctx.lineTo(target.x, target.y);
          ctx.stroke();
        }
      });

      // Nodes
      networkNodes.forEach(node => {
        ctx.beginPath();
        ctx.arc(node.x, node.y, node.r, 0, Math.PI * 2);

        if(node.group === 'MHA') ctx.fillStyle = '#48BB78';
        else if(node.group === 'DS') ctx.fillStyle = '#9F7AEA';
        else if(node.group === 'MCU') ctx.fillStyle = '#F56565';
        else if(node.group === 'Faculty') ctx.fillStyle = '#63B3ED';
        else ctx.fillStyle = '#A0AEC0'; // Family/Other

        ctx.fill();

        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.fillStyle = '#2D3748';
        ctx.font = '11px Inter';
        ctx.textAlign = 'center';
        ctx.fillText(node.label, node.x, node.y + node.r + 14);
      });
    }

    function loop() {
      updatePhysics();
      draw();
      animationFrameId = requestAnimationFrame(loop);
    }

    if (animationFrameId) cancelAnimationFrame(animationFrameId);
    loop();

    canvas.onmousemove = (e) => {
      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;

      let hovered = false;
      networkNodes.forEach(node => {
        const dist = Math.sqrt((mx - node.x) ** 2 + (my - node.y) ** 2);
        if (dist < node.r) {
          hovered = true;
          tooltip.style.display = 'block';
          tooltip.style.left = (e.pageX + 10) + 'px';
          tooltip.style.top = (e.pageY + 10) + 'px';
          document.getElementById('tooltipTitle').innerText = node.label;
          document.getElementById('tooltipRole').innerText = node.group;
          document.getElementById('tooltipDesc').innerText = node.desc;
          canvas.style.cursor = 'pointer';
        }
      });

      if (!hovered) {
        tooltip.style.display = 'none';
        canvas.style.cursor = 'default';
      }
    };
  }

  function resetGraph() {
    // Very basic reset to initial hardcoded positions
    // In a real app, we'd store initialCoords separate from current coords
    networkNodes[0].x = 400; networkNodes[0].y = 250;
  }

  // --- Logic: Dialogue Filter ---
  function filterDialogue(speaker) {
    const container = document.getElementById('dialogue-container');
    container.innerHTML = '';

    const filtered = speaker === 'all'
            ? dialogueData
            : dialogueData.filter(d => d.speaker === speaker || (speaker === 'Bakugo' && d.speaker === 'Katsuki'));

    filtered.forEach(line => {
      const div = document.createElement('div');
      div.className = 'p-4 rounded-lg bg-gray-50 border-l-4 border-gray-300 hover:bg-white hover:shadow-md transition-all';

      let borderColor = 'border-gray-300';
      if(line.mood === 'angry' || line.mood === 'protective' || line.mood === 'fear') borderColor = 'border-red-400';
      if(line.mood === 'sad' || line.mood === 'regretful') borderColor = 'border-blue-400';
      if(line.mood === 'grateful' || line.mood === 'neutral') borderColor = 'border-green-400';

      div.classList.remove('border-gray-300');
      div.classList.add(borderColor);

      div.innerHTML = `
                    <div class="flex justify-between items-center mb-1">
                        <span class="font-bold text-gray-800">${line.speaker}</span>
                        <span class="text-xs uppercase tracking-wider text-gray-400">${line.context}</span>
                    </div>
                    <p class="text-gray-700 italic">"${line.text}"</p>
                `;
      container.appendChild(div);
    });
  }

  // --- Initialization ---
  document.addEventListener('DOMContentLoaded', () => {
    initFandomChart();
    initEmotionChart();
    filterDialogue('all');

    window.addEventListener('resize', () => {
      if(state.activeTab === 'relationships') startNetworkSim();
    });
  });

</script>
</body>
</html>